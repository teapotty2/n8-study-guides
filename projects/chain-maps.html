<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 4: Pathophys ‚Üí Assessment ‚Üí Intervention Chain Maps | Nursing N8</title>
    <style>
        :root {
            --cardiac: #E74C3C;
            --fluid: #3498DB;
            --oxy: #27AE60;
            --neuro: #8E44AD;
            --emergency: #E67E22;

            --light-bg: #F0F2F5;
            --light-card: #FFFFFF;
            --light-text: #1a1a1a;
            --light-border: #E0E0E0;
            --light-shadow: rgba(0, 0, 0, 0.1);

            --dark-bg: #121218;
            --dark-card: #1e1e2a;
            --dark-text: #E8E8E8;
            --dark-border: #2a2a35;
            --dark-shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        body[data-theme="dark"] {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            padding: 10px 16px;
            background: var(--light-card);
            border: 1px solid var(--light-border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        body[data-theme="dark"] .back-btn {
            background: var(--dark-card);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .back-btn:hover {
            transform: translateX(-4px);
            box-shadow: 0 2px 8px var(--light-shadow);
        }

        body[data-theme="dark"] .back-btn:hover {
            box-shadow: 0 2px 8px var(--dark-shadow);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .theme-toggle {
            padding: 10px 16px;
            background: var(--light-card);
            border: 1px solid var(--light-border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        body[data-theme="dark"] .theme-toggle {
            background: var(--dark-card);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .controls {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        body[data-theme="dark"] .controls {
            background: var(--dark-card);
            border-color: var(--dark-border);
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 12px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border: 2px solid currentColor;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--light-shadow);
        }

        body[data-theme="dark"] .btn:hover {
            box-shadow: 0 4px 12px var(--dark-shadow);
        }

        .btn.active {
            background: currentColor;
            color: white;
        }

        .btn-exam-1 {
            color: var(--cardiac);
        }

        .btn-exam-2 {
            color: var(--oxy);
        }

        .btn-exam-3 {
            color: var(--neuro);
        }

        .btn-emergency {
            color: var(--emergency);
        }

        .btn-all {
            color: var(--light-text);
            opacity: 0.6;
        }

        body[data-theme="dark"] .btn-all {
            color: var(--dark-text);
            opacity: 0.6;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--light-bg);
            color: var(--light-text);
            transition: all 0.2s;
        }

        body[data-theme="dark"] .search-box input {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--cardiac);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .toggle-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: var(--light-border);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background: var(--cardiac);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--light-card);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .chains-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .chains-grid {
                grid-template-columns: 1fr;
            }
        }

        .chain-card {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 2px 8px var(--light-shadow);
        }

        body[data-theme="dark"] .chain-card {
            background: var(--dark-card);
            border-color: var(--dark-border);
            box-shadow: 0 2px 8px var(--dark-shadow);
        }

        .chain-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px var(--light-shadow);
        }

        body[data-theme="dark"] .chain-card:hover {
            box-shadow: 0 8px 16px var(--dark-shadow);
        }

        .chain-header {
            padding: 16px;
            background: linear-gradient(135deg, var(--color) 0%, var(--color-light) 100%);
            color: white;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chain-header h3 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .chain-expand-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .chain-card.expanded .chain-expand-icon {
            transform: rotate(180deg);
        }

        .chain-concept {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .chain-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .chain-card.expanded .chain-content {
            max-height: 2000px;
        }

        .chain-body {
            padding: 20px;
        }

        .chain-flow {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .chain-flow {
                gap: 12px;
            }
        }

        .chain-box {
            padding: 16px;
            background: var(--light-bg);
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 14px;
        }

        body[data-theme="dark"] .chain-box {
            background: var(--dark-bg);
        }

        .chain-box.pathophys {
            border-left-color: var(--color);
        }

        .chain-box.assessment {
            border-left-color: var(--color);
        }

        .chain-box.intervention {
            border-left-color: var(--color);
        }

        .chain-box-label {
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            opacity: 0.7;
        }

        .chain-box-content {
            line-height: 1.5;
        }

        .chain-arrow {
            text-align: center;
            color: var(--color);
            font-weight: bold;
            opacity: 0.6;
        }

        .chain-related {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--light-border);
        }

        body[data-theme="dark"] .chain-related {
            border-top-color: var(--dark-border);
        }

        .chain-related-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            opacity: 0.7;
        }

        .chain-related-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chain-link {
            padding: 6px 12px;
            background: var(--light-bg);
            border: 1px solid var(--light-border);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        body[data-theme="dark"] .chain-link {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .chain-link:hover {
            background: var(--color);
            color: white;
            border-color: var(--color);
        }

        .test-mode-section {
            background: var(--light-bg);
            border: 1px solid var(--light-border);
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
        }

        body[data-theme="dark"] .test-mode-section {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .test-mode-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            opacity: 0.7;
        }

        .test-mode-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 6px 12px;
            font-size: 12px;
            background: transparent;
            border: 1px solid var(--light-border);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        body[data-theme="dark"] .test-btn {
            border-color: var(--dark-border);
        }

        .test-btn:hover {
            background: var(--color);
            color: white;
            border-color: var(--color);
        }

        .test-btn.active {
            background: var(--color);
            color: white;
            border-color: var(--color);
        }

        .chain-box.hidden {
            opacity: 0.3;
            pointer-events: none;
        }

        .reveal-btn {
            padding: 8px 12px;
            background: var(--color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            transition: all 0.2s;
        }

        .reveal-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .stats {
            background: var(--light-card);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        body[data-theme="dark"] .stats {
            background: var(--dark-card);
            border-color: var(--dark-border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--cardiac);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--light-text);
            opacity: 0.6;
        }

        body[data-theme="dark"] .no-results {
            color: var(--dark-text);
        }

        .footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            opacity: 0.6;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .controls {
                padding: 16px;
            }

            .button-group {
                gap: 8px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            h1 {
                font-size: 22px;
            }

            header {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <button class="back-btn" onclick="try { if (window.parent &&  window.parent !== window) { window.parent.closeViewer(); return; } } catch(e) {} window.history.length > 1 ? window.history.back() : (window.location.href = '../n8-hub-complete.html');">‚Üê Back to Hub</button>
                <div>
                    <h1>Chain Maps</h1>
                    <p style="font-size: 13px; opacity: 0.7; margin-top: 4px;">Pathophys ‚Üí Assessment ‚Üí Intervention</p>
                </div>
            </div>
            <button class="theme-toggle" id="themeToggle">üåô Dark Mode</button>
        </header>

        <div class="controls">
            <div class="control-section">
                <label class="control-label">Filter by Exam</label>
                <div class="button-group">
                    <button class="btn btn-exam-1 active" data-filter="exam" data-value="exam1">üìç Exam 1: Cardiac</button>
                    <button class="btn btn-exam-2" data-filter="exam" data-value="exam2">üí® Exam 2: Oxygenation</button>
                    <button class="btn btn-exam-3" data-filter="exam" data-value="exam3">üß† Exam 3: Cognition</button>
                    <button class="btn btn-emergency" data-filter="exam" data-value="emergency">‚ö†Ô∏è Emergency</button>
                    <button class="btn btn-all" data-filter="exam" data-value="">All Conditions</button>
                </div>
            </div>

            <div class="control-section">
                <label class="control-label">Filter by Concept Area</label>
                <div class="button-group">
                    <button class="btn" style="color: var(--cardiac);" data-filter="concept" data-value="cardiac">ü´Ä Cardiac</button>
                    <button class="btn" style="color: var(--fluid);" data-filter="concept" data-value="fluid">üíß Fluid & Electrolytes</button>
                    <button class="btn" style="color: var(--oxy);" data-filter="concept" data-value="oxy">üí® Oxygenation</button>
                    <button class="btn" style="color: var(--neuro);" data-filter="concept" data-value="neuro">üß† Cognition-Sensation</button>
                    <button class="btn" style="color: var(--emergency);" data-filter="concept" data-value="emergency">‚ö†Ô∏è Emergency</button>
                </div>
            </div>

            <div class="control-section">
                <label class="control-label">Search</label>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Type a condition, symptom, intervention...">
                </div>
            </div>

            <div class="control-section">
                <label class="control-label">Tools</label>
                <div class="toggle-row">
                    <div class="toggle-item">
                        <span style="font-size: 13px;">Test Yourself Mode</span>
                        <div class="toggle-switch" id="testModeToggle"></div>
                    </div>
                    <button class="btn btn-all" style="padding: 8px 12px; font-size: 12px;" id="expandAllBtn">Expand All</button>
                    <button class="btn btn-all" style="padding: 8px 12px; font-size: 12px;" id="collapseAllBtn">Collapse All</button>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="totalChains">32</div>
                    <div class="stat-label">Total Chains</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="visibleChains">32</div>
                    <div class="stat-label">Visible</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="testedChains">0</div>
                    <div class="stat-label">Tested</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="masteredChains">0</div>
                    <div class="stat-label">Mastered</div>
                </div>
            </div>
        </div>

        <div id="chainsContainer" class="chains-grid"></div>

        <div id="noResults" class="no-results" style="display: none;">
            <p>No chains match your search. Try a different keyword or adjust your filters.</p>
        </div>

        <div class="footer">
            <p>Built to strengthen clinical reasoning: see the mechanism ‚Üí recognize the signs ‚Üí know what to do</p>
            <p style="margin-top: 10px; opacity: 0.5;">All content aligned to NCLEX-RN exam competencies</p>
        </div>
    </div>

    <script src="study-data.js" defer></script>
    <script>
        // Chain data structure
        const chains = [
            // CARDIAC (Exam 1)
            {
                id: 1,
                name: "Heart Failure ‚Äî Left-Sided",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "‚Üìcontractility/‚Üëafterload ‚Üí blood backs into pulmonary circuit",
                assessment: "Orthopnea, PND, crackles, S3 gallop, dyspnea, pink frothy sputum, ‚ÜìSpO‚ÇÇ, ‚ÜëBNP",
                intervention: "Upright position, O‚ÇÇ, diuretics (furosemide), ACE/ARB, beta-blocker, daily weights (2lb/day or 5lb/wk = call MD), Na‚Å∫ restriction, fluid restriction",
                related: [2, 16]
            },
            {
                id: 2,
                name: "Heart Failure ‚Äî Right-Sided",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "‚ÜìRV output ‚Üí blood backs into systemic circuit",
                assessment: "JVD, dependent edema, hepatomegaly, ascites, weight gain, ‚ÜëCVP",
                intervention: "Elevate legs, diuretics, Na‚Å∫ restriction, daily weights, I&O, monitor liver function",
                related: [1, 5]
            },
            {
                id: 3,
                name: "Acute Coronary Syndrome (STEMI/NSTEMI)",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Coronary artery occlusion ‚Üí myocardial ischemia/necrosis",
                assessment: "Crushing chest pain (jaw/arm/back), diaphoresis, N/V, ST elevation (STEMI), ‚Üëtroponin (3hrs‚Äì2wks), ‚ÜëCK-MB",
                intervention: "MONA (Morphine, O‚ÇÇ, NTG, Aspirin), 12-lead ECG, door-to-balloon <60min, door-to-needle <45min, PCI or tPA, beta-blocker, statin, anticoagulation",
                related: [4, 10]
            },
            {
                id: 4,
                name: "Valve Disorders (Mitral/Aortic)",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Stenosis (narrowing) or regurgitation (backward flow) ‚Üí altered flow/pressure",
                assessment: "Murmurs (location, timing, grade); aortic stenosis = loud systolic; aortic regurg = widened pulse pressure; mitral stenosis = diastolic rumble",
                intervention: "Monitor for HF symptoms, anticoagulation (mechanical valves = lifelong), activity modification, surgical repair/replacement",
                related: [1, 2]
            },
            {
                id: 5,
                name: "Cardiomyopathy",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Dilated (‚Üìcontractility), Hypertrophic (thick septum), or Restrictive (stiff walls)",
                assessment: "HF symptoms, arrhythmias, syncope (HCM), fatigue",
                intervention: "Treat underlying cause, HF management, ICD for EF <35%, avoid strenuous exercise (HCM), transplant evaluation",
                related: [1, 2]
            },
            {
                id: 6,
                name: "Endocarditis/Pericarditis",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Endocarditis: bacteria colonize valves ‚Üí emboli, valve destruction. Pericarditis: inflammation of pericardium",
                assessment: "Endocarditis = fever, new murmur, Janeway lesions, Osler nodes, splinter hemorrhages. Pericarditis = sharp chest pain (worse lying flat, better leaning forward), friction rub, diffuse ST elevation",
                intervention: "Endocarditis = IV antibiotics 4‚Äì6wks, blood cultures √ó3, prophylactic abx before dental. Pericarditis = NSAIDs, colchicine, monitor for tamponade",
                related: [7, 4]
            },
            {
                id: 7,
                name: "Pericardial Tamponade",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Fluid in pericardial sac ‚Üí compresses heart ‚Üí ‚Üìfilling",
                assessment: "Beck's triad (hypotension, JVD, muffled heart sounds), narrowed pulse pressure, tachycardia, pulsus paradoxus",
                intervention: "EMERGENCY ‚Äî pericardiocentesis, IV fluids, vasopressors, prepare for surgery",
                related: [6, 28]
            },
            {
                id: 8,
                name: "Hypertension",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "‚Üësystemic vascular resistance ‚Üí vascular damage",
                assessment: "Usually asymptomatic ('silent killer'), HA, visual changes, epistaxis. Stages: normal <120/80, elevated 120‚Äì129/<80, Stage 1 130‚Äì139/80‚Äì89, Stage 2 ‚â•140/‚â•90",
                intervention: "DASH diet, exercise 150min/wk, weight loss, ACE/ARB, thiazide diuretic, CCB. Emergency >180/120 = IV nicardipine/labetalol",
                related: [3, 23]
            },
            {
                id: 9,
                name: "Pulmonary Edema",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Acute LV failure ‚Üí fluid floods alveoli",
                assessment: "Severe dyspnea, pink frothy sputum, crackles throughout, tachycardia, anxiety/restlessness, cyanosis, ‚ÜìSpO‚ÇÇ",
                intervention: "HIGH Fowler's, O‚ÇÇ (non-rebreather), IV furosemide, IV NTG, morphine (cautiously), continuous monitoring",
                related: [1, 12]
            },
            {
                id: 10,
                name: "DVT/PE",
                concept: "cardiac",
                exam: "exam1",
                color: "#E74C3C",
                pathophys: "Virchow's triad (stasis, endothelial injury, hypercoagulability) ‚Üí thrombus formation",
                assessment: "DVT = unilateral leg swelling/pain/warmth/redness, Homans sign (unreliable). PE = sudden dyspnea, pleuritic chest pain, tachycardia, ‚ÜìSpO‚ÇÇ, hemoptysis",
                intervention: "Anticoagulation (heparin ‚Üí warfarin/DOAC), SCDs, early ambulation, IVC filter if can't anticoagulate",
                related: [3, 15]
            },

            // OXYGENATION (Exam 2)
            {
                id: 11,
                name: "Pneumonia",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Infection ‚Üí alveolar inflammation/consolidation",
                assessment: "Fever, productive cough (yellow/green sputum), crackles, tachypnea, pleuritic pain, ‚ÜëWBC, CXR infiltrate",
                intervention: "Antibiotics (based on CAP vs HAP vs VAP), O‚ÇÇ, incentive spirometry, hydration, position for lung expansion, vaccines (PCV13, PPSV23)",
                related: [12, 13, 15]
            },
            {
                id: 12,
                name: "ARDS",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Severe inflammatory response ‚Üí diffuse alveolar damage ‚Üí loss of surfactant",
                assessment: "Acute onset dyspnea, refractory hypoxemia (doesn't respond to O‚ÇÇ), bilateral CXR infiltrates, ‚Üìcompliance, PaO‚ÇÇ/FiO‚ÇÇ <300",
                intervention: "Intubation + mechanical ventilation, low tidal volume (6mL/kg), PEEP, prone positioning, sedation, neuromuscular blockade if needed, treat underlying cause",
                related: [11, 15, 16]
            },
            {
                id: 13,
                name: "Atelectasis",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Alveolar collapse (post-op most common)",
                assessment: "Diminished breath sounds, crackles, tachypnea, tachycardia, ‚ÜìSpO‚ÇÇ, low-grade fever",
                intervention: "ICOUGH (Incentive spirometry, Cough/deep breathe, Oral care, Understanding, Get OOB √ó3/day, HOB >30¬∞), position changes q2h, pain control, early ambulation",
                related: [11, 12, 15]
            },
            {
                id: 14,
                name: "Acute Respiratory Failure",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Ventilation/oxygenation failure",
                assessment: "PaO‚ÇÇ <60, PaCO‚ÇÇ >50, pH <7.35, restlessness‚Üíconfusion‚Üílethargy, tachycardia, accessory muscle use, cyanosis (late)",
                intervention: "O‚ÇÇ, possible intubation, treat underlying cause, ABG monitoring, positioning",
                related: [15, 12, 11]
            },
            {
                id: 15,
                name: "Mechanical Ventilation",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Positive pressure ventilation ‚Üí potential complications (VAP, barotrauma, hemodynamic effects)",
                assessment: "Monitor vent synchrony (agitation, nasal flaring, accessory muscles = fighting vent), peak pressures, ABGs, SpO‚ÇÇ, breath sounds",
                intervention: "Modes (A/C, SIMV, Pressure Support), PEEP titration. VAP Bundle (HOB 30‚Äì45¬∞, daily sedation vacation, PUD prophylaxis, DVT prophylaxis, chlorhexidine oral care q2h). Weaning: daily spontaneous breathing trials, monitor for red flags (‚ÜëCO‚ÇÇ, ‚ÜëHR, ‚ÜëRR, diaphoresis)",
                related: [14, 12, 13]
            },
            {
                id: 16,
                name: "Pleural Effusion/Empyema",
                concept: "oxy",
                exam: "exam2",
                color: "#27AE60",
                pathophys: "Fluid/pus in pleural space ‚Üí lung compression",
                assessment: "Dyspnea (worse lying flat), diminished breath sounds, dullness to percussion, pleuritic pain, fever (empyema)",
                intervention: "Thoracentesis, chest tube if thick/purulent, antibiotics (empyema), position on affected side",
                related: [9, 11, 12]
            },

            // FLUID & ELECTROLYTES
            {
                id: 17,
                name: "Hyperkalemia",
                concept: "fluid",
                exam: "exam1",
                color: "#3498DB",
                pathophys: "K‚Å∫ >5.0 ‚Üí cardiac conduction changes",
                assessment: "Peaked T waves, widened QRS, muscle weakness, paresthesias, cardiac arrest risk",
                intervention: "Calcium gluconate (stabilize cardiac membrane), insulin + D50 (shift K‚Å∫ intracellular), albuterol (shift), Kayexalate (excrete), dialysis if severe. HOLD K‚Å∫-sparing diuretics",
                related: [18, 19]
            },
            {
                id: 18,
                name: "Hypokalemia",
                concept: "fluid",
                exam: "exam1",
                color: "#3498DB",
                pathophys: "K‚Å∫ <3.5 ‚Üí cardiac/neuromuscular effects",
                assessment: "U waves, flat T waves, ST depression, muscle weakness, cramps, fatigue, ileus, arrhythmias",
                intervention: "Oral KCl (safest), IV KCl (never push, max 10mEq/hr peripheral), monitor ECG, assess digoxin level (hypoK‚Å∫ ‚Üëtoxicity risk)",
                related: [17, 19]
            },
            {
                id: 19,
                name: "DKA",
                concept: "fluid",
                exam: "exam1",
                color: "#3498DB",
                pathophys: "Insulin deficiency ‚Üí hyperglycemia + ketoacidosis",
                assessment: "Glucose 300‚Äì800, pH <7.30, Kussmaul breathing, fruity breath, ketones +, bicarb <15, dehydration, N/V, abdominal pain",
                intervention: "IV fluids FIRST (NS), then insulin drip (regular), K‚Å∫ replacement (insulin drives K‚Å∫ in), hourly glucose, neuro checks, cardiac monitoring",
                related: [20, 17]
            },
            {
                id: 20,
                name: "HHS",
                concept: "fluid",
                exam: "exam1",
                color: "#3498DB",
                pathophys: "Relative insulin deficiency ‚Üí severe hyperglycemia without ketosis",
                assessment: "Glucose >600 (often >1000), pH >7.30, no ketoacidosis, severe dehydration, altered mental status, seizures possible",
                intervention: "Aggressive IV fluids (may need 6‚Äì10L), insulin drip (lower dose than DKA), K‚Å∫ monitoring, neuro checks for cerebral edema",
                related: [19, 17]
            },
            {
                id: 21,
                name: "Burns",
                concept: "fluid",
                exam: "exam1",
                color: "#3498DB",
                pathophys: "Thermal/chemical injury ‚Üí massive fluid shifts, protein loss, hypermetabolic state",
                assessment: "Rule of nines (% TBSA), depth (superficial, partial, full thickness), airway burns (singed nasal hair, hoarse voice, soot in sputum), fluid loss signs",
                intervention: "Parkland formula (4mL √ó kg √ó %TBSA, half in first 8hr), wound care, pain management, escharotomy if needed, infection prevention, nutritional support, monitor for compartment syndrome",
                related: [28, 29]
            },

            // COGNITION-SENSATION (Exam 3)
            {
                id: 22,
                name: "Ischemic Stroke",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "Thrombus/embolus ‚Üí cerebral artery occlusion ‚Üí tissue ischemia",
                assessment: "Sudden unilateral weakness/numbness, facial droop, speech difficulty, visual changes, time of onset critical. NIH Stroke Scale assessment",
                intervention: "tPA within 4.5 hours (check criteria), BP management (permissive hypertension initially), NIH Stroke Scale, neuro checks q15‚Äì30min, swallow assessment before PO, DVT prophylaxis, early PT/OT",
                related: [23, 24]
            },
            {
                id: 23,
                name: "Hemorrhagic Stroke",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "Ruptured aneurysm/vessel ‚Üí bleeding into brain ‚Üí ‚ÜëICP",
                assessment: "Sudden severe headache ('worst of my life'), N/V, altered LOC, signs of ‚ÜëICP, possible seizure",
                intervention: "BP control (‚Üìgently), possible surgical clipping/coiling, seizure precautions, monitor ICP, HOB 30¬∞, quiet environment, stool softeners (prevent Valsalva)",
                related: [22, 24, 25]
            },
            {
                id: 24,
                name: "Increased ICP",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "‚Üëbrain volume or blood or CSF (Monro-Kellie) ‚Üí ‚Üìcerebral perfusion",
                assessment: "Headache, vomiting (projectile), altered LOC, pupil changes (unilateral dilation = herniation sign), Cushing's triad (HTN, bradycardia, irregular respirations), posturing (decorticate‚Üídecerebrate‚Üíflaccid)",
                intervention: "HOB 30‚Äì45¬∞, head midline, avoid hip flexion/Valsalva, osmotic diuretics (mannitol), hypertonic saline, CPP monitoring (goal 70‚Äì80, <50 = irreversible damage), quiet environment, seizure precautions",
                related: [23, 25, 26]
            },
            {
                id: 25,
                name: "Seizures/Status Epilepticus",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "Uncontrolled electrical discharge ‚Üí sustained seizure activity (SE: ‚â•5 min)",
                assessment: "Document type/duration/behavior before-during-after, postictal state, tongue biting, incontinence, ‚Üëtemp, rhabdomyolysis signs",
                intervention: "Protect airway (side-lying), suction, pad rails, O‚ÇÇ, lorazepam 2mg IV (may repeat √ó1), check glucose, monitor for rhabdomyolysis (CK, dark urine), SE = medical emergency",
                related: [24, 22]
            },
            {
                id: 26,
                name: "Post-Craniotomy Care",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "Surgical brain manipulation ‚Üí risk of cerebral edema (peaks 24‚Äì36hr), infection",
                assessment: "Frequent neuro checks (LOC, pupils, motor), VS q15‚Äì60min, dressing for bleeding/CSF leak (halo sign), seizure activity",
                intervention: "HOB per surgeon (usually 30¬∞), avoid extreme head rotation, monitor ICP, anticonvulsants, strict aseptic technique, no coughing/sneezing/nose blowing (CSF leak risk), dressing changes",
                related: [24, 25]
            },
            {
                id: 27,
                name: "Guillain-Barr√© Syndrome",
                concept: "neuro",
                exam: "exam3",
                color: "#8E44AD",
                pathophys: "Autoimmune demyelination ‚Üí ascending paralysis",
                assessment: "Progressive ascending weakness (starts in legs), ‚ÜìDTRs, respiratory compromise (monitor vital capacity), autonomic dysfunction (BP/HR swings)",
                intervention: "Monitor respiratory function closely (may need intubation if VC <20mL/kg), plasmapheresis or IVIG, DVT prophylaxis, pain management, ROM exercises, emotional support",
                related: [14, 15]
            },

            // EMERGENCY
            {
                id: 28,
                name: "Hypovolemic Shock",
                concept: "emergency",
                exam: "emergency",
                color: "#E67E22",
                pathophys: "‚Üìcirculating volume (hemorrhage, burns, dehydration) ‚Üí ‚Üìpreload ‚Üí ‚ÜìCO ‚Üí inadequate tissue perfusion",
                assessment: "Tachycardia, hypotension, cool/clammy skin, ‚ÜìUO, altered mental status, ‚Üëlactate (>2)",
                intervention: "2 large-bore IVs, crystalloids (NS/LR) 30mL/kg bolus, blood products if hemorrhage, control bleeding source, MAP goal ‚â•65, continuous monitoring",
                related: [29, 21]
            },
            {
                id: 29,
                name: "Septic Shock",
                concept: "emergency",
                exam: "emergency",
                color: "#E67E22",
                pathophys: "Infection ‚Üí systemic inflammatory response ‚Üí vasodilation ‚Üí ‚Üìperfusion",
                assessment: "Fever/hypothermia, tachycardia, hypotension (refractory to fluids), warm/flushed skin (early) ‚Üí cool/mottled (late), ‚Üëlactate >2, ‚ÜëWBC or ‚ÜìWBC",
                intervention: "Sepsis Bundle: blood cultures before abx, broad-spectrum antibiotics within 1hr, 30mL/kg crystalloid bolus, vasopressors (norepinephrine 1st line) if MAP <65 after fluids, lactate monitoring",
                related: [28, 11]
            },
            {
                id: 30,
                name: "Anaphylaxis",
                concept: "emergency",
                exam: "emergency",
                color: "#E67E22",
                pathophys: "Severe allergic reaction ‚Üí massive vasodilation + bronchospasm ‚Üí shock",
                assessment: "Urticaria, angioedema, stridor, wheezing, hypotension, tachycardia, may have flushing",
                intervention: "EPINEPHRINE IM (first-line, don't delay), O‚ÇÇ, IV fluids, antihistamines (diphenhydramine), corticosteroids, albuterol for bronchospasm, monitor for biphasic reaction",
                related: [30, 29]
            },
            {
                id: 31,
                name: "Carbon Monoxide Poisoning",
                concept: "emergency",
                exam: "emergency",
                color: "#E67E22",
                pathophys: "CO binds Hb 200√ó more than O‚ÇÇ ‚Üí cellular hypoxia despite normal sat reading",
                assessment: "Headache, confusion, dizziness, cherry-red skin (unreliable), pulse ox MISLEADING (shows normal sat), carboxyhemoglobin level diagnostic",
                intervention: "Remove from source, 100% O‚ÇÇ (NRB or hyperbaric), continue until carboxyhemoglobin <5%, monitor for neuro deficits, consider hyperbaric oxygen if severe",
                related: [29, 14]
            },
            {
                id: 32,
                name: "Heat Stroke",
                concept: "emergency",
                exam: "emergency",
                color: "#E67E22",
                pathophys: "Thermoregulation failure ‚Üí core temp ‚â•40.6¬∞C ‚Üí cellular damage",
                assessment: "Altered mental status, hot dry skin, tachycardia, hypotension, temp ‚â•105¬∞F, muscle rigidity",
                intervention: "Cool to 39.2¬∞C within 1 hour (ice packs to neck/groin/axillae, cooling blankets, fan), STOP cooling at 38¬∞C (avoid iatrogenic hypothermia), IV fluids, monitor for rhabdomyolysis/DIC/AKI",
                related: [28, 21]
            }
        ];

        // Color hex to rgb with transparency
        function hexToRgb(hex, alpha = 0.1) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // State management
        let state = {
            currentExamFilter: "exam1",
            currentConceptFilter: "",
            searchTerm: "",
            testMode: false,
            testHiddenColumns: {}, // Map of chainId -> hidden column
            expandedChains: new Set(),
            chainResults: {}
        };

        // Load theme and state
        function loadTheme() {
            const isDark = localStorage.getItem("n8hub_darkmode") === "true";
            if (isDark) {
                document.documentElement.setAttribute("data-theme", "dark");
                document.getElementById("themeToggle").textContent = "‚òÄÔ∏è Light Mode";
            }
        }

        // Load persisted state
        function loadState() {
            const saved = localStorage.getItem("chainmaps_state");
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state.currentExamFilter = parsed.currentExamFilter || "exam1";
                    state.currentConceptFilter = parsed.currentConceptFilter || "";
                    state.testMode = parsed.testMode || false;
                    state.testHiddenColumns = parsed.testHiddenColumns || {};
                    state.expandedChains = new Set(parsed.expandedChains || []);

                    // Restore UI state
                    if (state.testMode) {
                        document.getElementById("testModeToggle").classList.add("active");
                    }

                    // Restore exam filter button state
                    document.querySelectorAll('[data-filter="exam"]').forEach(b => {
                        if (b.getAttribute("data-value") === state.currentExamFilter) {
                            b.classList.add("active");
                        }
                    });

                    // Restore concept filter button state
                    if (state.currentConceptFilter) {
                        document.querySelectorAll('[data-filter="concept"]').forEach(b => {
                            if (b.getAttribute("data-value") === state.currentConceptFilter) {
                                b.classList.add("active");
                            }
                        });
                    }
                } catch (e) {
                    console.error("Failed to load chain-maps state:", e);
                }
            }
        }

        // Save state
        function saveState() {
            localStorage.setItem("chainmaps_state", JSON.stringify({
                currentExamFilter: state.currentExamFilter,
                currentConceptFilter: state.currentConceptFilter,
                testMode: state.testMode,
                testHiddenColumns: state.testHiddenColumns,
                expandedChains: Array.from(state.expandedChains)
            }));
        }

        // Toggle theme
        document.getElementById("themeToggle").addEventListener("click", function() {
            const isDark = document.documentElement.getAttribute("data-theme") === "dark";
            if (isDark) {
                document.documentElement.removeAttribute("data-theme");
                localStorage.setItem("n8hub_darkmode", "false");
                this.textContent = "üåô Dark Mode";
            } else {
                document.documentElement.setAttribute("data-theme", "dark");
                localStorage.setItem("n8hub_darkmode", "true");
                this.textContent = "‚òÄÔ∏è Light Mode";
            }
        });

        // Filter buttons
        document.querySelectorAll("[data-filter]").forEach(btn => {
            btn.addEventListener("click", function() {
                const filterType = this.getAttribute("data-filter");
                const filterValue = this.getAttribute("data-value");

                if (filterType === "exam") {
                    document.querySelectorAll('[data-filter="exam"]').forEach(b => b.classList.remove("active"));
                    this.classList.add("active");
                    state.currentExamFilter = filterValue;
                } else if (filterType === "concept") {
                    document.querySelectorAll('[data-filter="concept"]').forEach(b => b.classList.remove("active"));
                    if (state.currentConceptFilter === filterValue) {
                        state.currentConceptFilter = "";
                    } else {
                        this.classList.add("active");
                        state.currentConceptFilter = filterValue;
                    }
                }

                filterChains();
                saveState();
            });
        });

        // Search
        document.getElementById("searchInput").addEventListener("input", function() {
            state.searchTerm = this.value.toLowerCase();
            filterChains();
        });

        // Test mode toggle
        document.getElementById("testModeToggle").addEventListener("click", function() {
            state.testMode = !state.testMode;
            this.classList.toggle("active");
            renderChains();
            saveState();
        });

        // Expand/Collapse all
        document.getElementById("expandAllBtn").addEventListener("click", function() {
            document.querySelectorAll(".chain-card").forEach(card => {
                if (card.style.display !== "none") {
                    card.classList.add("expanded");
                    state.expandedChains.add(parseInt(card.getAttribute("data-id")));
                }
            });
            saveState();
        });

        document.getElementById("collapseAllBtn").addEventListener("click", function() {
            document.querySelectorAll(".chain-card").forEach(card => {
                card.classList.remove("expanded");
                state.expandedChains.delete(parseInt(card.getAttribute("data-id")));
            });
            saveState();
        });

        // Filter logic
        function filterChains() {
            const filtered = chains.filter(chain => {
                let pass = true;

                // Exam filter (empty string means show all exams)
                if (state.currentExamFilter !== "" && chain.exam !== state.currentExamFilter) {
                    pass = false;
                }

                // Concept filter
                if (state.currentConceptFilter && chain.concept !== state.currentConceptFilter) {
                    pass = false;
                }

                // Search filter
                if (state.searchTerm) {
                    const searchableText = `${chain.name} ${chain.pathophys} ${chain.assessment} ${chain.intervention}`.toLowerCase();
                    if (!searchableText.includes(state.searchTerm)) {
                        pass = false;
                    }
                }

                return pass;
            });

            // Update visibility
            document.querySelectorAll(".chain-card").forEach(card => {
                const id = parseInt(card.getAttribute("data-id"));
                card.style.display = filtered.some(c => c.id === id) ? "" : "none";
            });

            // Update stats
            document.getElementById("visibleChains").textContent = filtered.length;

            // Show/hide no results
            const noResults = filtered.length === 0;
            document.getElementById("noResults").style.display = noResults ? "block" : "none";
        }

        // Render chains
        function renderChains() {
            const container = document.getElementById("chainsContainer");
            container.innerHTML = "";

            chains.forEach(chain => {
                const card = document.createElement("div");
                card.className = "chain-card";
                card.setAttribute("data-id", chain.id);

                const lightColor = hexToRgb(chain.color, 0.15);

                let testContent = "";
                if (state.testMode) {
                    const hiddenCol = state.testHiddenColumns[chain.id] || "";
                    const hidePathophys = hiddenCol === "pathophys";
                    const hideAssessment = hiddenCol === "assessment";
                    const hideIntervention = hiddenCol === "intervention";

                    testContent = `
                        <div class="test-mode-section">
                            <div class="test-mode-label">Test Mode: Fill in the Missing Column</div>
                            <div class="test-mode-buttons">
                                <button class="test-btn ${hidePathophys ? "active" : ""}" onclick="setTestMode(${chain.id}, 'pathophys')">Hide Pathophys</button>
                                <button class="test-btn ${hideAssessment ? "active" : ""}" onclick="setTestMode(${chain.id}, 'assessment')">Hide Assessment</button>
                                <button class="test-btn ${hideIntervention ? "active" : ""}" onclick="setTestMode(${chain.id}, 'intervention')">Hide Interventions</button>
                            </div>
                        </div>
                    `;
                }

                let relatedHtml = "";
                if (chain.related && chain.related.length > 0) {
                    const validRelated = chain.related
                        .map(relatedId => chains.find(c => c.id === relatedId))
                        .filter(c => c !== undefined); // Only include if chain exists

                    if (validRelated.length > 0) {
                        relatedHtml = `
                            <div class="chain-related">
                                <div class="chain-related-label">Related Chains</div>
                                <div class="chain-related-links">
                                    ${validRelated.map(relatedChain => {
                                        return `<div class="chain-link" onclick="scrollToChain(${relatedChain.id})">${relatedChain.name}</div>`;
                                    }).join("")}
                                </div>
                            </div>
                        `;
                    }
                }

                card.innerHTML = `
                    <div class="chain-header" style="--color: ${chain.color}; --color-light: ${lightColor}; background: linear-gradient(135deg, ${chain.color} 0%, ${hexToRgb(chain.color, 0.7)} 100%);" onclick="toggleChain(${chain.id})">
                        <div>
                            <h3>${chain.name}</h3>
                            <div class="chain-concept">${chain.exam.toUpperCase()}</div>
                        </div>
                        <div class="chain-expand-icon">‚ñº</div>
                    </div>
                    <div class="chain-content">
                        <div class="chain-body" style="--color: ${chain.color};">
                            <div class="chain-flow">
                                <div class="chain-box pathophys ${state.testHiddenColumns[chain.id] === "pathophys" ? "hidden" : ""}">
                                    <div class="chain-box-label">üî¨ Pathophysiology</div>
                                    <div class="chain-box-content">${chain.pathophys}</div>
                                    ${state.testHiddenColumns[chain.id] === "pathophys" ? `<button class="reveal-btn" onclick="revealChainBox(${chain.id}, 'pathophys')">Reveal</button>` : ""}
                                </div>
                                <div class="chain-arrow">‚Üì</div>
                                <div class="chain-box assessment ${state.testHiddenColumns[chain.id] === "assessment" ? "hidden" : ""}">
                                    <div class="chain-box-label">üëÅÔ∏è Assessment Findings</div>
                                    <div class="chain-box-content">${chain.assessment}</div>
                                    ${state.testHiddenColumns[chain.id] === "assessment" ? `<button class="reveal-btn" onclick="revealChainBox(${chain.id}, 'assessment')">Reveal</button>` : ""}
                                </div>
                                <div class="chain-arrow">‚Üì</div>
                                <div class="chain-box intervention ${state.testHiddenColumns[chain.id] === "intervention" ? "hidden" : ""}">
                                    <div class="chain-box-label">üíä Nursing/Medical Interventions</div>
                                    <div class="chain-box-content">${chain.intervention}</div>
                                    ${state.testHiddenColumns[chain.id] === "intervention" ? `<button class="reveal-btn" onclick="revealChainBox(${chain.id}, 'intervention')">Reveal</button>` : ""}
                                </div>
                            </div>
                            ${relatedHtml}
                            ${testContent}
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });

            // Restore expanded state
            state.expandedChains.forEach(id => {
                const card = container.querySelector(`[data-id="${id}"]`);
                if (card) {
                    card.classList.add("expanded");
                }
            });
        }

        // Toggle chain expansion
        function toggleChain(id) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) {
                card.classList.toggle("expanded");
                if (card.classList.contains("expanded")) {
                    state.expandedChains.add(id);
                } else {
                    state.expandedChains.delete(id);
                }
                saveState();
            }
        }

        // Set test mode (per-chain)
        function setTestMode(chainId, column) {
            if (state.testHiddenColumns[chainId] === column) {
                delete state.testHiddenColumns[chainId];
            } else {
                state.testHiddenColumns[chainId] = column;
            }
            renderChains();
            saveState();

            // Track in StudyData if available
            if (typeof StudyData !== "undefined") {
                StudyData.trackExposure(`chain-maps:${chains.find(c => c.id === chainId).name}`);
            }
        }

        // Reveal hidden box
        function revealChainBox(chainId, column) {
            delete state.testHiddenColumns[chainId];
            renderChains();
            saveState();

            // Record test result
            if (typeof StudyData !== "undefined") {
                const chainName = chains.find(c => c.id === chainId).name;
                StudyData.recordResult(`chain-maps:${chainName}`, true, `Test mode - Revealed ${column}`);
            }
        }

        // Scroll to chain
        function scrollToChain(id) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card && card.style.display !== "none") {
                card.scrollIntoView({ behavior: "smooth", block: "center" });
                card.classList.add("expanded");
                state.expandedChains.add(id);
            }
        }

        // Initialize
        loadTheme();
        loadState();
        renderChains();
        filterChains();
    </script>
</body>
</html>
