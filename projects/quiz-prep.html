<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Prep Hub ‚Äî N8</title>
<style>
:root {
  --cardiac: #E74C3C;
  --cardiac-bg: #FDEDEC;
  --fluid: #3498DB;
  --fluid-bg: #EBF5FB;
  --oxy: #27AE60;
  --oxy-bg: #EAFAF1;
  --neuro: #8E44AD;
  --neuro-bg: #F4ECF7;
  --emergency: #E67E22;
  --emergency-bg: #FEF5E7;
  --bg: #F0F2F5;
  --card: #FFFFFF;
  --text: #1a1a2e;
  --text-muted: #7F8C8D;
  --border: #E8ECF0;
  --shadow: 0 2px 12px rgba(0,0,0,0.06);
  --shadow-hover: 0 8px 24px rgba(0,0,0,0.12);
  --surface: #f8f9fa;
  --surface-hover: #eef0f3;
  --success: #27AE60;
  --warning: #E67E22;
  --danger: #E74C3C;
}

[data-theme="dark"] {
  --bg: #121218;
  --card: #1e1e2a;
  --text: #e8e8f0;
  --text-muted: #a0a0b0;
  --border: #2d2d3d;
  --shadow: 0 2px 12px rgba(0,0,0,0.3);
  --shadow-hover: 0 8px 24px rgba(0,0,0,0.5);
  --surface: #2a2a35;
  --surface-hover: #35353f;
  --cardiac-bg: #3a1f1f;
  --fluid-bg: #1f2a3a;
  --oxy-bg: #1f3a28;
  --neuro-bg: #2f1f3a;
  --emergency-bg: #3a2a1f;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  transition: background-color 0.3s, color 0.3s;
}
a { text-decoration: none; color: inherit; }
button { font-family: inherit; cursor: pointer; border: none; }

.container { max-width: 1300px; margin: 0 auto; padding: 20px; }

/* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
.header {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
  color: white;
  padding: 28px 32px;
  border-radius: 18px;
  margin-bottom: 24px;
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}

[data-theme="dark"] .header {
  background: linear-gradient(135deg, #0f1a2e 0%, #1a2a42 50%, #1a3a5a 100%);
}
.header::before {
  content: '';
  position: absolute;
  top: -40%;
  right: -10%;
  width: 350px;
  height: 350px;
  background: radial-gradient(circle, rgba(52,152,219,0.15) 0%, transparent 70%);
  border-radius: 50%;
}
.header-content { position: relative; z-index: 1; flex: 1; min-width: 300px; }
.header h1 { font-size: 1.85em; font-weight: 800; margin-bottom: 6px; }
.header .subtitle { opacity: 0.8; font-size: 0.92em; }

.header-btn {
  position: relative;
  z-index: 1;
  padding: 10px 20px;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 10px;
  color: white;
  font-weight: 600;
  font-size: 0.9em;
  transition: all 0.2s;
  white-space: nowrap;
}
.header-btn:hover { background: rgba(255,255,255,0.25); }

/* ‚îÄ‚îÄ‚îÄ TAB NAVIGATION ‚îÄ‚îÄ‚îÄ */
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  border-bottom: 2px solid var(--border);
  flex-wrap: wrap;
}

.tab-btn {
  padding: 12px 20px;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--text-muted);
  font-weight: 600;
  font-size: 0.95em;
  cursor: pointer;
  transition: all 0.2s;
}

.tab-btn:hover {
  color: var(--text);
}

.tab-btn.active {
  color: var(--fluid);
  border-bottom-color: var(--fluid);
}

/* ‚îÄ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ‚îÄ */
.controls {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
  align-items: center;
}

.dark-mode-toggle {
  padding: 8px 12px;
  border-radius: 8px;
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text);
  font-size: 1em;
  box-shadow: var(--shadow);
  transition: all 0.2s;
}

.dark-mode-toggle:hover { background: var(--surface); }

/* ‚îÄ‚îÄ‚îÄ SECTION CONTENT ‚îÄ‚îÄ‚îÄ */
.section {
  display: none;
}

.section.active {
  display: block;
}

/* ‚îÄ‚îÄ‚îÄ COMPARISON CONTAINER ‚îÄ‚îÄ‚îÄ */
.comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 24px;
}

.condition-box {
  background: var(--card);
  border-radius: 12px;
  padding: 24px;
  box-shadow: var(--shadow);
}

.condition-box.dka {
  border-left: 5px solid var(--danger);
}

.condition-box.hhs {
  border-left: 5px solid var(--fluid);
}

.condition-title {
  font-size: 1.3em;
  font-weight: 800;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.condition-detail {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.condition-detail:last-child {
  border-bottom: none;
}

.detail-label {
  font-weight: 700;
  font-size: 0.8em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.detail-value {
  font-size: 0.95em;
  line-height: 1.5;
  color: var(--text);
}

/* ‚îÄ‚îÄ‚îÄ QUIZ SCENARIO BOXES ‚îÄ‚îÄ‚îÄ */
.quiz-container {
  background: var(--card);
  border-radius: 12px;
  padding: 28px;
  box-shadow: var(--shadow);
  margin-bottom: 24px;
}

.quiz-header {
  text-align: center;
  margin-bottom: 24px;
}

.quiz-header h2 {
  font-size: 1.4em;
  font-weight: 800;
  margin-bottom: 8px;
}

.quiz-progress {
  font-size: 0.9em;
  color: var(--text-muted);
  margin-bottom: 12px;
}

.progress-bar-bg {
  height: 6px;
  background: var(--surface);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 8px;
}

.progress-bar-fill {
  height: 100%;
  background: var(--fluid);
  border-radius: 3px;
  transition: width 0.3s;
}

.scenario-box {
  background: var(--surface);
  border-left: 4px solid var(--fluid);
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 24px;
}

.scenario-label {
  font-weight: 700;
  font-size: 0.75em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 8px;
}

.scenario-patient {
  font-size: 0.95em;
  line-height: 1.6;
  color: var(--text);
}

.quiz-buttons {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  justify-content: center;
}

.decision-btn {
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 700;
  font-size: 1em;
  transition: all 0.2s;
  border: 2px solid;
  cursor: pointer;
}

.correct-btn {
  background: var(--success);
  color: white;
  border-color: var(--success);
}

.correct-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(39,174,96,0.3); }

.incorrect-btn {
  background: var(--danger);
  color: white;
  border-color: var(--danger);
}

.incorrect-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(231,76,60,0.3); }

.decision-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.feedback {
  background: var(--surface);
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 20px;
  display: none;
  border-left: 4px solid;
}

.feedback.show { display: block; }

.feedback.correct {
  border-left-color: var(--success);
  background: rgba(39,174,96,0.1);
}

.feedback.incorrect {
  border-left-color: var(--danger);
  background: rgba(231,76,60,0.1);
}

.feedback-title {
  font-weight: 700;
  margin-bottom: 6px;
  color: var(--text);
}

.feedback.correct .feedback-title { color: var(--success); }
.feedback.incorrect .feedback-title { color: var(--danger); }

.feedback-text {
  font-size: 0.9em;
  line-height: 1.6;
  color: var(--text);
}

/* ‚îÄ‚îÄ‚îÄ CRANIAL NERVE CARDS ‚îÄ‚îÄ‚îÄ */
.cards-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.flip-card {
  perspective: 1000px;
  height: 320px;
  cursor: pointer;
  position: relative;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flip-card.flipped .flip-card-inner {
  transform: rotateY(180deg);
}

.flip-card-front, .flip-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  flex-direction: column;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  background: var(--card);
  border-left: 5px solid var(--neuro);
}

.flip-card-front {
  z-index: 2;
}

.flip-card-back {
  transform: rotateY(180deg);
  overflow-y: auto;
}

.flip-card:hover .flip-card-front {
  box-shadow: var(--shadow-hover);
  transform: translateY(-3px);
}

.cn-number {
  font-size: 1.6em;
  font-weight: 800;
  color: var(--neuro);
  margin-bottom: 4px;
}

.cn-name {
  font-size: 1.2em;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 8px;
}

.cn-type {
  display: inline-block;
  padding: 4px 10px;
  background: var(--neuro-bg);
  color: var(--neuro);
  border-radius: 6px;
  font-size: 0.75em;
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.cn-hint {
  font-size: 0.85em;
  color: var(--text-muted);
  font-style: italic;
  margin-top: 8px;
}

.cn-back-content {
  font-size: 0.9em;
  line-height: 1.5;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.cn-section {
  margin-bottom: 8px;
}

.cn-label {
  font-weight: 700;
  color: var(--neuro);
  font-size: 0.75em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

/* ‚îÄ‚îÄ‚îÄ vSIM CARDS ‚îÄ‚îÄ‚îÄ */
.vsim-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.vsim-card {
  background: var(--card);
  border-radius: 12px;
  padding: 20px;
  box-shadow: var(--shadow);
  transition: all 0.2s;
}

.vsim-card:hover {
  box-shadow: var(--shadow-hover);
  transform: translateY(-2px);
}

.vsim-patient {
  font-size: 1.1em;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 8px;
}

.vsim-scenario {
  font-size: 0.9em;
  color: var(--text-muted);
  margin-bottom: 12px;
  line-height: 1.5;
}

.vsim-critical {
  background: var(--emergency-bg);
  padding: 12px;
  border-radius: 8px;
  border-left: 3px solid var(--emergency);
  margin-bottom: 12px;
  font-size: 0.85em;
  color: var(--emergency);
  font-weight: 600;
}

.vsim-due {
  font-size: 0.8em;
  color: var(--text-muted);
  font-style: italic;
  padding-top: 8px;
  border-top: 1px solid var(--border);
}

/* ‚îÄ‚îÄ‚îÄ ASSESSMENT DRILL ‚îÄ‚îÄ‚îÄ */
.assessment-item {
  background: var(--surface);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 12px;
  border-left: 4px solid var(--neuro);
}

.assessment-scenario {
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text);
}

.assessment-answer {
  background: var(--card);
  padding: 10px;
  border-radius: 6px;
  margin-top: 8px;
  font-size: 0.9em;
  color: var(--text-muted);
}

.assessment-answer strong {
  color: var(--neuro);
}

/* ‚îÄ‚îÄ‚îÄ MNEMONIC ‚îÄ‚îÄ‚îÄ */
.mnemonic-box {
  background: var(--neuro-bg);
  border-left: 4px solid var(--neuro);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 24px;
}

.mnemonic-title {
  font-weight: 700;
  color: var(--neuro);
  margin-bottom: 8px;
  font-size: 0.9em;
}

.mnemonic-text {
  font-size: 1em;
  font-style: italic;
  color: var(--text);
  line-height: 1.6;
}

/* ‚îÄ‚îÄ‚îÄ SHARED FEATURES BOX ‚îÄ‚îÄ‚îÄ */
.shared-features {
  background: var(--card);
  border-radius: 12px;
  padding: 24px;
  box-shadow: var(--shadow);
  margin-bottom: 32px;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
}

.feature-item {
  padding: 12px;
  background: var(--surface);
  border-radius: 8px;
  border-left: 4px solid;
}

/* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
.footer {
  text-align: center;
  padding: 20px;
  font-size: 0.78em;
  color: var(--text-muted);
  margin-top: 40px;
}

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    padding: 20px;
  }

  .header h1 { font-size: 1.4em; }

  .comparison {
    grid-template-columns: 1fr;
  }

  .tabs {
    width: 100%;
  }

  .tab-btn {
    font-size: 0.85em;
    padding: 10px 14px;
  }

  .cards-container, .vsim-grid {
    grid-template-columns: 1fr;
  }

  .flip-card {
    height: 380px;
  }
}

/* ‚îÄ‚îÄ‚îÄ PRINT STYLES ‚îÄ‚îÄ‚îÄ */
@media print {
  .header-btn, .controls, .tabs, .dark-mode-toggle {
    display: none;
  }

  .comparison {
    page-break-inside: avoid;
  }

  .section { page-break-inside: avoid; }
}

</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-content">
      <h1>Quiz Prep Hub</h1>
      <p class="subtitle">N8 ‚Äî DKA/HHS | Cranial Nerves | vSim Scenarios</p>
    </div>
    <button class="header-btn" onclick="goBack()">‚Üê Back to Hub</button>
  </div>

  <div class="controls">
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="themeToggle">üåô</button>
  </div>

  <!-- TAB NAVIGATION -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="dka-hhs" onclick="switchTab('dka-hhs')">DKA vs. HHS</button>
    <button class="tab-btn" data-tab="cranial" onclick="switchTab('cranial')">Cranial Nerves</button>
    <button class="tab-btn" data-tab="vsim" onclick="switchTab('vsim')">vSim Prep Cards</button>
  </div>

  <!-- SECTION 1: DKA/HHS -->
  <div id="dka-hhs" class="section active">
    <h2 style="margin-bottom: 20px; font-size: 1.5em; font-weight: 800;">DKA vs. HHS: Comparator & Quiz</h2>

    <!-- COMPARISON VIEW -->
    <div style="margin-bottom: 32px;">
      <h3 style="margin-bottom: 16px; font-size: 1.15em; font-weight: 700;">Side-by-Side Comparison</h3>
      <div class="comparison">
        <div class="condition-box dka">
          <div class="condition-title">
            <span style="font-size: 1.4em;">üî¥</span> DKA
          </div>
          <div class="condition-detail">
            <div class="detail-label">Type</div>
            <div class="detail-value">Type 1 Diabetes (insulin-dependent)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Onset</div>
            <div class="detail-value">Rapid (hours)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">pH</div>
            <div class="detail-value">&lt; 7.30 (severe acidosis)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Glucose</div>
            <div class="detail-value">300-800 (can reach 1000)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Respiration</div>
            <div class="detail-value">Kussmaul breathing (deep, rapid, fruity-scented)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Ketones</div>
            <div class="detail-value">Present in blood & urine</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Bicarbonate</div>
            <div class="detail-value">&lt; 15 mEq/L</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Causes</div>
            <div class="detail-value">Missed insulin, infection, illness, stress</div>
          </div>
        </div>

        <div class="condition-box hhs">
          <div class="condition-title">
            <span style="font-size: 1.4em;">üîµ</span> HHS
          </div>
          <div class="condition-detail">
            <div class="detail-label">Type</div>
            <div class="detail-value">Type 2 Diabetes (insulin resistance)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Onset</div>
            <div class="detail-value">Gradual (days to weeks)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">pH</div>
            <div class="detail-value">&gt; 7.30 (NO acidosis)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Glucose</div>
            <div class="detail-value">&gt; 600 (often &gt; 1000)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Respiration</div>
            <div class="detail-value">Normal or shallow (no Kussmaul)</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Ketones</div>
            <div class="detail-value">ABSENT or minimal</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Bicarbonate</div>
            <div class="detail-value">&gt; 15 mEq/L</div>
          </div>
          <div class="condition-detail">
            <div class="detail-label">Key Features</div>
            <div class="detail-value">Severe dehydration, altered mental status, NO acidosis, older adults at risk</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SHARED PRIORITIES -->
    <div class="shared-features">
      <h3 style="margin-bottom: 16px; font-size: 1.1em; font-weight: 700;">Shared Features & Nursing Priorities</h3>
      <div class="feature-grid">
        <div class="feature-item" style="border-left-color: var(--fluid);">
          <div style="font-weight: 700; margin-bottom: 6px;">Both Present With:</div>
          <div style="font-size: 0.9em;">Polyuria (excessive urination), Polydipsia (excessive thirst), Dehydration</div>
        </div>
        <div class="feature-item" style="border-left-color: var(--cardiac);">
          <div style="font-weight: 700; margin-bottom: 6px;">PRIORITY 1: Fluid Resuscitation</div>
          <div style="font-size: 0.9em;">BEFORE insulin! Massive fluid loss (6-10L). NS 500-1000mL/hr √ó 2-3 hours</div>
        </div>
        <div class="feature-item" style="border-left-color: var(--warning);">
          <div style="font-weight: 700; margin-bottom: 6px;">PRIORITY 2: Insulin + K+ Monitoring</div>
          <div style="font-size: 0.9em;">Regular insulin IV continuous. K+ drops with rehydration + insulin. Monitor closely!</div>
        </div>
        <div class="feature-item" style="border-left-color: var(--danger);">
          <div style="font-weight: 700; margin-bottom: 6px;">DANGER: Cerebral Edema (DKA)</div>
          <div style="font-size: 0.9em;">Monitor neuro status closely. Avoid rapid fluid shifts. Head elevation 30 degrees.</div>
        </div>
      </div>
    </div>

    <!-- QUIZ SCENARIOS -->
    <div style="margin-bottom: 32px;">
      <h3 style="margin-bottom: 16px; font-size: 1.1em; font-weight: 700;">Quiz: DKA vs. HHS Scenarios</h3>
      <div id="dkaQuizContainer"></div>
    </div>
  </div>

  <!-- SECTION 2: CRANIAL NERVES -->
  <div id="cranial" class="section">
    <h2 style="margin-bottom: 20px; font-size: 1.5em; font-weight: 800;">Cranial Nerve Drill</h2>

    <!-- MNEMONIC -->
    <div class="mnemonic-box">
      <div class="mnemonic-title">Memory Aid</div>
      <div class="mnemonic-text">
        Oh, Oh, Oh, To Touch And Feel Very Good Velvet AH
      </div>
      <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 8px;">
        (I - Olfactory | II - Optic | III - Oculomotor | IV - Trochlear | V - Trigeminal | VI - Abducens | VII - Facial | VIII - Vestibulocochlear | IX - Glossopharyngeal | X - Vagus | XI - Accessory | XII - Hypoglossal)
      </div>
    </div>

    <!-- CRANIAL NERVE CARDS -->
    <div style="margin-bottom: 32px;">
      <div class="cards-container" id="cnCardsContainer"></div>
    </div>

    <!-- ASSESSMENT DRILL -->
    <div style="background: var(--card); border-radius: 12px; padding: 24px; box-shadow: var(--shadow); margin-bottom: 32px;">
      <h3 style="margin-bottom: 16px; font-size: 1.1em; font-weight: 700;">Assessment Drill: Clinical Scenarios</h3>
      <div id="cnAssessmentContainer"></div>
    </div>

    <!-- SPEED ROUND -->
    <div style="background: var(--fluid-bg); border-left: 4px solid var(--fluid); border-radius: 8px; padding: 20px;">
      <h3 style="margin-bottom: 12px; font-size: 1em; font-weight: 700; color: var(--fluid);">Speed Round</h3>
      <p style="font-size: 0.9em; margin-bottom: 12px;">Can you name all 12 cranial nerves in order? Test yourself: <strong>Time yourself for 2 minutes</strong>. Write them out or recite aloud.</p>
      <div id="cnSpeedRound"></div>
    </div>
  </div>

  <!-- SECTION 3: vSIM SCENARIOS -->
  <div id="vsim" class="section">
    <h2 style="margin-bottom: 20px; font-size: 1.5em; font-weight: 800;">vSim Scenario Prep Cards</h2>
    <p style="margin-bottom: 20px; font-size: 0.95em; color: var(--text-muted);">Pre-game cards for the 6 vSim scenarios. Review critical decision points and common mistakes before your simulation.</p>

    <div class="vsim-grid" id="vsimCardsContainer"></div>
  </div>
</div>

<div class="footer">
  Quiz Prep Hub | N8 NCLEX-RN Intensive | Last updated: Feb 2025
</div>

<script src="study-data.js"></script>
<script>

// ‚îÄ‚îÄ‚îÄ INITIALIZATION ‚îÄ‚îÄ‚îÄ
let currentTab = 'dka-hhs';

// ‚îÄ‚îÄ‚îÄ DKA/HHS QUIZ DATA ‚îÄ‚îÄ‚îÄ
const dkaHhsQuiz = [
  {
    scenario: '27-year-old with Type 1 DM, missed insulin doses. Rapid onset SOB, fruity breath, pH 7.15, glucose 550, bicarb 12, keytones positive.',
    answer: 'DKA',
    reasoning: 'Classic DKA: Type 1, rapid onset, Kussmaul breathing (fruity breath), LOW pH, positive ketones.'
  },
  {
    scenario: '68-year-old Type 2 DM, brought in with altered mental status. Glucose 1200, pH 7.38, bicarb 22, NO keytones, severe dehydration.',
    answer: 'HHS',
    reasoning: 'HHS hallmarks: Type 2, altered mental status (key!), NORMAL pH, NO ketones, extreme hyperglycemia.'
  },
  {
    scenario: 'Patient admitted with DKA. After 3L NS + insulin drip √ó 4 hours, glucose down to 250. Which comes next?',
    answer: 'Add dextrose to IV fluid',
    reasoning: 'When glucose approaches 300, add D5 or D10 to IV to prevent hypoglycemia while continuing to lower pH/bicarb.'
  },
  {
    scenario: 'DKA patient, K+ = 3.2 mEq/L (baseline was 4.5). Vitals stable, no symptoms. Next action?',
    answer: 'Add K+ 20 mEq/L to IV',
    reasoning: 'Total body K+ is depleted in DKA even if serum K+ looks low. Replace even if <4 mEq/L. Monitor ECG.'
  },
  {
    scenario: 'HHS vs DKA: Which causes FASTER onset and requires FASTER intervention?',
    answer: 'DKA (acidosis = more dangerous acutely)',
    reasoning: 'DKA = rapid hours, life-threatening acidosis. HHS = gradual days, higher mortality but slower onset.'
  },
  {
    scenario: 'Nursing priority in BOTH DKA & HHS when patient arrives?',
    answer: 'Aggressive fluid resuscitation FIRST, then insulin',
    reasoning: 'Fluids restore perfusion & help lower glucose via osmotic diuresis. Insulin second to prevent hypoglycemia.'
  },
  {
    scenario: 'Patient on DKA protocol. Which lab should be checked HOURLY?',
    answer: 'Blood glucose (POCT)',
    reasoning: 'Glucose drops rapidly with IV insulin. Need frequent checks to avoid hypo. Every hour until stable, then q2h.'
  },
  {
    scenario: 'DKA treatment: When can patient transition from IV insulin drip to subcutaneous?',
    answer: 'When bicarb >15, pH >7.30, patient eating, glucose stable on scale',
    reasoning: 'Only when acidosis resolved + PO intake possible. Continue IV drip until SubQ started (overlap 30-60 min).'
  },
  {
    scenario: 'Pt with HHS has glucose 1500. Brain cells losing water due to osmotic gradient. Risk?',
    answer: 'Seizures, cerebral edema, altered mental status',
    reasoning: 'Extreme hyperglycemia causes severe osmotic shift. Brain dehydrates ‚Üí neuro changes. Monitor LOC closely.'
  },
  {
    scenario: 'DKA patient: Bicarb 8, pH 6.9 (severe acidosis). Respiratory pattern should be?',
    answer: 'Kussmaul breathing - deep, rapid, fruity-scented',
    reasoning: 'Body tries to blow off CO2 to compensate for acidosis. This is appropriate respiratory compensation.'
  }
];

// ‚îÄ‚îÄ‚îÄ CRANIAL NERVE DATA ‚îÄ‚îÄ‚îÄ
const cranialNerves = [
  {
    number: 'I',
    name: 'Olfactory',
    type: 'Sensory',
    function: 'Smell (olfaction)',
    assessment: 'Ask patient to smell familiar odor (coffee, vanilla) with eyes closed, each nostril separately',
    deficit: 'Anosmia (loss of smell)',
    clinical: 'Head trauma, Parkinson\'s'
  },
  {
    number: 'II',
    name: 'Optic',
    type: 'Sensory',
    function: 'Vision',
    assessment: 'Visual acuity (Snellen chart), visual fields (confrontation), ophthalmoscopy',
    deficit: 'Visual loss, hemianopsia, scotomas',
    clinical: 'Stroke (occipital lobe), optic neuritis, glaucoma'
  },
  {
    number: 'III',
    name: 'Oculomotor',
    type: 'Motor & Parasympathetic',
    function: 'Eye movement (up, down, medial), pupil constriction, lens accommodation',
    assessment: 'Pupil size/reactivity, extraocular movements (EOM), ptosis assessment',
    deficit: 'Ptosis, dilated pupil, "down-and-out" eye, ophthalmoplegia',
    clinical: 'Weber\'s syndrome, cavernous sinus syndrome, uncal herniation'
  },
  {
    number: 'IV',
    name: 'Trochlear',
    type: 'Motor',
    function: 'Eye movement (downward, medial gaze), superior oblique muscle',
    assessment: 'Check for vertical eye movement, ask to look down-and-inward',
    deficit: 'Diplopia on downward gaze, head tilt away from lesion',
    clinical: 'Head trauma (most common CN IV injury)'
  },
  {
    number: 'V',
    name: 'Trigeminal',
    type: 'Sensory & Motor',
    function: 'Face sensation (3 divisions: ophthalmic, maxillary, mandibular), jaw movement (chewing)',
    assessment: 'Light touch/pin prick to face (3 divisions), jaw clench, bite strength',
    deficit: 'Facial numbness, weakness chewing, trigeminal neuralgia',
    clinical: 'Stroke, TN (tic douloureux), multiple sclerosis'
  },
  {
    number: 'VI',
    name: 'Abducens',
    type: 'Motor',
    function: 'Lateral eye movement (abduction), lateral rectus muscle',
    assessment: 'Check lateral eye movement in all six cardinal positions',
    deficit: 'Medial deviation ("eyes look toward nose"), inability to abduct',
    clinical: 'Stroke (pontine), increased ICP, diabetic neuropathy'
  },
  {
    number: 'VII',
    name: 'Facial',
    type: 'Motor & Sensory',
    function: 'Facial expression, taste (anterior 2/3 tongue), tear/saliva secretion',
    assessment: 'Smile/grimace symmetry, eye close, forehead wrinkles, taste (sweet/salt)',
    deficit: 'Unilateral facial droop, inability to close eye, loss of taste',
    clinical: 'Bell\'s palsy, stroke (contralateral weakness in UMN lesion), parotitis'
  },
  {
    number: 'VIII',
    name: 'Vestibulocochlear',
    type: 'Sensory',
    function: 'Hearing (cochlear), balance/equilibrium (vestibular)',
    assessment: 'Weber & Rinne tests (hearing), Romberg test (balance), nystagmus',
    deficit: 'Hearing loss, vertigo, nystagmus, ataxia',
    clinical: 'Stroke (cerebellum), vestibulitis, acoustic neuroma, labyrinthitis'
  },
  {
    number: 'IX',
    name: 'Glossopharyngeal',
    type: 'Sensory & Motor',
    function: 'Taste (posterior 1/3 tongue), pharyngeal sensation & movement, swallowing initiation',
    assessment: 'Gag reflex (IX & X together), pharyngeal elevation, taste posterior tongue',
    deficit: 'Absent gag, difficulty swallowing, loss of taste',
    clinical: 'Post-stroke, dysphagia screening, lateral medullary syndrome'
  },
  {
    number: 'X',
    name: 'Vagus',
    type: 'Sensory & Motor & Parasympathetic',
    function: 'Pharyngeal/laryngeal movement, vocalization, parasympathetic (heart, lungs, GI)',
    assessment: 'Gag reflex, voice quality, "say AH" (palate elevation), swallow',
    deficit: 'Dysphagia, hoarseness, nasal speech, palate asymmetry',
    clinical: 'Post-stroke, post-surgery (vagal nerve damage), brainstem lesion'
  },
  {
    number: 'XI',
    name: 'Accessory',
    type: 'Motor',
    function: 'Shoulder shrug (trapezius), head turn (SCM)',
    assessment: 'Shrug shoulders against resistance, turn head against resistance',
    deficit: 'Shoulder droop, weakness head turning',
    clinical: 'Neck trauma, skull base surgery'
  },
  {
    number: 'XII',
    name: 'Hypoglossal',
    type: 'Motor',
    function: 'Tongue movement, deglutition',
    assessment: 'Stick tongue out (midline vs deviation), tongue strength',
    deficit: 'Tongue deviation toward weak side, atrophy',
    clinical: 'Stroke (medullary), ALS (progressive weakness)'
  }
];

// ‚îÄ‚îÄ‚îÄ CRANIAL NERVE ASSESSMENT DRILL ‚îÄ‚îÄ‚îÄ
const cnAssessmentDrill = [
  {
    scenario: 'Post-stroke patient can\'t swallow, drooling, absent gag reflex. Which nerves?',
    answer: 'CN IX (Glossopharyngeal) & CN X (Vagus)'
  },
  {
    scenario: 'Bell\'s palsy: Unilateral facial droop, can\'t close eye, loss of taste on that side. Which nerve?',
    answer: 'CN VII (Facial)'
  },
  {
    scenario: 'Patient can\'t move eyes laterally (medial deviation). Which nerve?',
    answer: 'CN VI (Abducens)'
  },
  {
    scenario: 'Dilated pupil, "down and out" eye position. Which nerve?',
    answer: 'CN III (Oculomotor)'
  },
  {
    scenario: 'Loss of taste anterior 2/3 tongue. Likely CN?',
    answer: 'CN VII (Facial)'
  },
  {
    scenario: 'Hoarseness, difficulty swallowing, nasal speech after thyroid surgery. Which nerve likely damaged?',
    answer: 'CN X (Vagus)'
  },
  {
    scenario: 'Patient can\'t chew or feel face; jaw hangs open. Which nerve?',
    answer: 'CN V (Trigeminal)'
  },
  {
    scenario: 'Vertigo, nystagmus, inability to balance. Which nerve test?',
    answer: 'CN VIII (Vestibulocochlear) - Romberg test, doll\'s eyes'
  },
  {
    scenario: 'Shoulder droop, can\'t shrug. Which nerve?',
    answer: 'CN XI (Accessory)'
  },
  {
    scenario: 'Tongue deviates to the LEFT side (atrophy left). Which side had a stroke?',
    answer: 'RIGHT (contralateral CN XII lesion = ipsilateral tongue deviation)'
  }
];

// ‚îÄ‚îÄ‚îÄ vSIM SCENARIOS ‚îÄ‚îÄ‚îÄ
const vsimScenarios = [
  {
    name: 'Carl Shapiro',
    chief: 'Acute MI',
    age: '66',
    background: 'H/o HTN, smoker',
    scenario: 'Acute chest pain, SOB, diaphoresis',
    critical: 'MONA protocol, 12-lead ECG <10min, Troponin, activate cath lab if STEMI',
    commonMistakes: 'Delaying ECG, missing right-sided infarct (RV needs fluids, not diuretics), not checking O2/IV access',
    assessment: 'VS, chest pain character, neuro status, lung sounds, ECG interpretation',
    meds: 'Morphine, O2, Aspirin, Nitroglycerin, Beta-blocker, ACE inhibitor',
    due: '3/22'
  },
  {
    name: 'Liling Zhao',
    chief: 'Arrhythmia',
    age: '72',
    background: 'A-fib history, on digoxin',
    scenario: 'RVR with decreased BP, LOC change',
    critical: 'Identify rhythm (V-fib? V-tach? A-fib RVR?), Hemodynamic stability = shock vs no shock, Cardiovert or medicate?',
    commonMistakes: 'Treating rhythm without considering hemodynamics, wrong cardioversion dose, missing digoxin toxicity',
    assessment: 'Pulse check (is there one?), BP, LOC, continuous monitor, 12-lead ECG',
    meds: 'Amiodarone, epinephrine (code), digoxin level, electrolytes (K+, Mg2+)',
    due: '3/22'
  },
  {
    name: 'Jennifer Hoffman',
    chief: 'Acute Asthma Exacerbation',
    age: '34',
    background: 'Asthma, allergies',
    scenario: 'SOB, wheezing, O2 sat dropped, peak flow low',
    critical: 'Peak flow assessment, Œ≤2-agonist (albuterol) sequence, Steroids, when to escalate to IV therapy',
    commonMistakes: 'Not escalating fast enough, missing status asthmaticus (silent chest = emergency), forgetting steroids',
    assessment: 'Peak flow, O2 sat, breath sounds (wheezing vs silent chest), RR, accessory muscle use, LOC',
    meds: 'Albuterol neb, ipratropium, systemic steroids (IV methylprednisolone)',
    due: '3/20'
  },
  {
    name: 'Vincent Brody',
    chief: 'COPD Exacerbation',
    age: '68',
    background: 'COPD, emphysema, on home O2',
    scenario: 'Increased SOB, sputum change, O2 sat drop despite home O2',
    critical: 'O2 titration (CAREFUL - hypoxic drive!), Bronchodilator vs steroid timing, ABG interpretation',
    commonMistakes: 'Giving too much O2 (pushing pH up, patient stops breathing), missing pneumonia/PE, wrong bronchodilator order',
    assessment: 'ABG (baseline CO2 is high), O2 sat, breath sounds, sputum color/amount, RR, LOC',
    meds: 'Albuterol, ipratropium, oral/IV steroids, O2 goal 88-92% (NOT >94% - risks CO2 retention)',
    due: '3/20'
  },
  {
    name: 'Brandon Sharp',
    chief: 'Spinal Cord Injury (T4 complete)',
    age: '22',
    background: 'MVA, acute SCI',
    scenario: 'Paralyzed below T4, bladder/bowel dysfunction, risk for complications',
    critical: 'Differentiate SPINAL SHOCK (areflexia, flaccid) from NEUROGENIC SHOCK (hypotension, bradycardia)',
    commonMistakes: 'Confusing spinal ‚Üî neurogenic shock, missing autonomic dysreflexia (headache + HTN + bradycardia = EMERGENCY), improper handling',
    assessment: 'Neuro level (sensory + motor), reflexes, BP/HR stability, full bladder assessment, skin integrity',
    meds: 'Maintaining MAP ‚â•85 (in hyperacute phase), vasopressors if neurogenic shock, antibiotics if infection risk',
    due: '3/27'
  },
  {
    name: 'William Edwards',
    chief: 'Ischemic Stroke',
    age: '58',
    background: 'H/o HTN, A-fib, no anticoag',
    scenario: 'Acute weakness left side, speech difficulty, alert, time = 90 min since onset',
    critical: 'NIH Stroke Scale (NIHSS), tPA window (3-4.5hr), BP control (permissive HTN in penumbra)',
    commonMistakes: 'Delaying CT, giving IV fluid push (worsens edema), controlling BP too aggressively, missing hemorrhage',
    assessment: 'BEFAST (Balance, Eyes, Face, Arms, Speech, Time), NIHSS, CT head, ECG, glucose, lipid panel',
    meds: 'tPA (0.9mg/kg, 10% bolus, rest over 1hr) if eligible, aspirin post-thrombolysis, atorvastatin',
    due: '3/27'
  }
];

// ‚îÄ‚îÄ‚îÄ RENDER DKA/HHS QUIZ ‚îÄ‚îÄ‚îÄ
function renderDKAQuiz() {
  const container = document.getElementById('dkaQuizContainer');
  container.innerHTML = '';

  dkaHhsQuiz.forEach((q, idx) => {
    const box = document.createElement('div');
    box.className = 'assessment-item';
    box.innerHTML = `
      <div class="assessment-scenario">Q${idx + 1}: ${q.scenario}</div>
      <div class="assessment-answer">
        <strong>Answer:</strong> ${q.answer}<br>
        <span style="font-style: italic; color: var(--text-muted);">${q.reasoning}</span>
      </div>
    `;
    container.appendChild(box);
  });
}

// ‚îÄ‚îÄ‚îÄ RENDER CRANIAL NERVES ‚îÄ‚îÄ‚îÄ
function renderCranialNerves() {
  const container = document.getElementById('cnCardsContainer');
  container.innerHTML = '';

  cranialNerves.forEach(cn => {
    const card = document.createElement('div');
    card.className = 'flip-card';
    card.innerHTML = `
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <div class="cn-number">CN ${cn.number}</div>
          <div class="cn-name">${cn.name}</div>
          <div class="cn-type">${cn.type}</div>
          <div style="margin-top: auto; font-size: 0.8em; color: var(--text-muted);">‚Üê Click to assess</div>
        </div>
        <div class="flip-card-back">
          <div class="cn-back-content">
            <div class="cn-section">
              <div class="cn-label">Function</div>
              <div>${cn.function}</div>
            </div>
            <div class="cn-section">
              <div class="cn-label">How to Assess</div>
              <div>${cn.assessment}</div>
            </div>
            <div class="cn-section">
              <div class="cn-label">If Deficit</div>
              <div>${cn.deficit}</div>
            </div>
            <div class="cn-section">
              <div class="cn-label">Clinical Conditions</div>
              <div>${cn.clinical}</div>
            </div>
          </div>
        </div>
      </div>
    `;

    card.addEventListener('click', () => {
      card.classList.toggle('flipped');
    });

    container.appendChild(card);
  });
}

// ‚îÄ‚îÄ‚îÄ RENDER CN ASSESSMENT DRILL ‚îÄ‚îÄ‚îÄ
function renderCNAssessment() {
  const container = document.getElementById('cnAssessmentContainer');
  container.innerHTML = '';

  cnAssessmentDrill.forEach((q, idx) => {
    const item = document.createElement('div');
    item.className = 'assessment-item';
    item.innerHTML = `
      <div class="assessment-scenario">Q${idx + 1}: ${q.scenario}</div>
      <div class="assessment-answer">
        <strong>Answer:</strong> ${q.answer}
      </div>
    `;
    container.appendChild(item);
  });
}

// ‚îÄ‚îÄ‚îÄ RENDER CN SPEED ROUND ‚îÄ‚îÄ‚îÄ
function renderCNSpeedRound() {
  const container = document.getElementById('cnSpeedRound');
  let html = '<div style="font-size: 0.9em; line-height: 1.8;">';

  cranialNerves.forEach(cn => {
    html += `<div><strong>CN ${cn.number}:</strong> ${cn.name}</div>`;
  });

  html += '</div>';
  container.innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ RENDER vSIM CARDS ‚îÄ‚îÄ‚îÄ
function renderVsimCards() {
  const container = document.getElementById('vsimCardsContainer');
  container.innerHTML = '';

  vsimScenarios.forEach(vsim => {
    const card = document.createElement('div');
    card.className = 'vsim-card';
    card.innerHTML = `
      <div class="vsim-patient">${vsim.name}</div>
      <div style="font-size: 0.85em; color: var(--text-muted); margin-bottom: 8px;">
        <strong>${vsim.chief}</strong> | Age ${vsim.age}
      </div>
      <div class="vsim-scenario">
        <strong>Background:</strong> ${vsim.background}<br>
        <strong>Chief Complaint:</strong> ${vsim.scenario}
      </div>
      <div class="vsim-critical">
        <strong>üö® Critical Points:</strong> ${vsim.critical}
      </div>
      <div style="font-size: 0.85em; margin-bottom: 8px; padding: 8px; background: var(--surface); border-radius: 6px;">
        <strong style="color: var(--emergency);">Common Mistakes:</strong> ${vsim.commonMistakes}
      </div>
      <div style="font-size: 0.85em; margin-bottom: 8px; padding: 8px; background: var(--surface); border-radius: 6px;">
        <strong>Assessment Priority:</strong> ${vsim.assessment}
      </div>
      <div style="font-size: 0.85em; margin-bottom: 8px; padding: 8px; background: var(--surface); border-radius: 6px;">
        <strong>Key Meds/Interventions:</strong> ${vsim.meds}
      </div>
      <div class="vsim-due">
        Due: <strong>${vsim.due}</strong>
      </div>
    `;
    container.appendChild(card);
  });
}

// ‚îÄ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ‚îÄ
function applyTheme() {
  const saved = localStorage.getItem('n8hub_darkmode');
  if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme:dark)').matches)) {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('themeToggle').textContent = 'üåô';
  }
}

function toggleDarkMode() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  const newTheme = isDark ? 'light' : 'dark';
  html.setAttribute('data-theme', newTheme);
  localStorage.setItem('n8hub_darkmode', newTheme);
  document.getElementById('themeToggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
}

// ‚îÄ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ‚îÄ
function switchTab(tabName) {
  currentTab = tabName;

  // Hide all sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');

  // Update button styles using data attribute
  document.querySelectorAll('.tab-btn').forEach(btn => {
    if (btn.dataset.tab === tabName) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

// ‚îÄ‚îÄ‚îÄ BACK TO HUB ‚îÄ‚îÄ‚îÄ
function goBack() {
  try { if (window.parent && window.parent !== window) { window.parent.closeViewer(); return; } } catch(e) {}
  window.history.length > 1 ? window.history.back() : (window.location.href = '../n8-hub-complete.html');
}

// ‚îÄ‚îÄ‚îÄ TRACK DATA ‚îÄ‚îÄ‚îÄ
function trackData() {
  if (typeof StudyData !== 'undefined') {
    // Track exposure to study material
    StudyData.trackExposure('quiz-prep-hub', 'DKA vs HHS Comparator');
    StudyData.trackExposure('quiz-prep-hub', 'Cranial Nerve Drill');
    StudyData.trackExposure('quiz-prep-hub', 'vSim Scenario Prep');

    // Record learning results
    StudyData.recordResult('quiz-prep', 'fluid-electrolytes', dkaHhsQuiz.length, dkaHhsQuiz.length);
    StudyData.recordResult('quiz-prep', 'cognition-sensation', cranialNerves.length, cranialNerves.length);
  }
}

// ‚îÄ‚îÄ‚îÄ INITIALIZE ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  applyTheme();
  renderDKAQuiz();
  renderCranialNerves();
  renderCNAssessment();
  renderCNSpeedRound();
  renderVsimCards();
  trackData();
});

</script>

</body>
</html>
